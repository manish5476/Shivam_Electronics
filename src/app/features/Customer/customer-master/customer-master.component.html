<section class="text-gray-400 bg-gray-900 body-font p-4"> 
  <div class="container px-5 py-12 mx-auto flex flex-wrap">
   <div class="flex w-full mb-8 flex-wrap justify-center"> 
    <h1 class="sm:text-3xl text-2xl font-medium title-font text-white lg:mb-0 mb-4 text-center">Customer Profile</h1>
    </div>
    <div class="flex flex-wrap md:-m-2 -m-1 w-full">
      <div class="w-full md:w-1/3 p-2 mx-auto">
        <div class="bg-gray-800 rounded-lg p-4 flex flex-col h-full border border-gray-700 shadow-lg">
          <div class="w-32 h-32 border-2 border-gray-600 rounded-lg flex items-center justify-center overflow-hidden mb-4 bg-gray-900 mx-auto">
            <img *ngIf="customer.profileImg" [src]="customer.profileImg" alt="Profile Image" class="w-full h-full object-cover">
            <i *ngIf="!customer.profileImg" class="pi pi-user text-gray-500 text-6xl"></i>
          </div>
    
          <button (click)="fileUploader.choose()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded-md flex items-center gap-2 mx-auto justify-center">
            <i class="pi pi-upload"></i> Upload
          </button>
    
          <p *ngIf="uploadStatus" class="mt-2 text-sm text-green-500 text-center">{{ uploadStatus }}</p>
    
          <div class="mt-4">
            <label for="status" class="block text-sm font-medium text-gray-300 mb-1">Status</label>
            <p-select id="status" [options]="statuses" [(ngModel)]="customer.status" class="w-full border border-gray-600 rounded-md p-2 bg-gray-800 text-white"></p-select>
          </div>
    
          <div class="mt-4">
            <label for="guaranteer" class="block text-sm font-medium text-gray-300 mb-1">Guaranteer Name</label>
            <input id="guaranteer" type="text" class="w-full border border-gray-600 rounded-md p-2 bg-gray-800 text-white" [(ngModel)]="customer.guaranteerId" autocomplete="off">
          </div>
        </div>
    </div>



    <div class="flex flex-wrap w-full md:w-2/3 p-2"> 
      <div class="md:p-2 p-1 w-full">
    
        <!-- Name & Email Card -->
        <div class="bg-gray-800 p-4 rounded-lg shadow-md border border-gray-700">
          <p-card header="Personal Information" class="bg-gray-900 text-white">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label for="fullname" class="block text-sm font-medium text-gray-300">Full Name</label>
                <input id="fullname" type="text" class="p-inputtext w-full bg-gray-800 text-white border border-gray-600 rounded-md p-2" [(ngModel)]="customer.fullname" required />
              </div>
              <div>
                <label for="email" class="block text-sm font-medium text-gray-300">Email</label>
                <input id="email" type="email" class="p-inputtext w-full bg-gray-800 text-white border border-gray-600 rounded-md p-2" [(ngModel)]="customer.email" required />
              </div>
            </div>
          </p-card>
        </div>
    
        <!-- Phone Numbers Card -->
        <div class="mt-4 bg-gray-800 p-4 rounded-lg shadow-md border border-gray-700">
          <p-card header="Phone Numbers" class="bg-gray-900 text-white">
            <p-table [value]="customer.phoneNumbers" [paginator]="true" [rows]="3" class="mt-4 bg-gray-900 text-white">
              <ng-template pTemplate="header">
                <tr>
                  <th>Number</th>
                  <th>Type</th>
                  <th>Primary</th>
                  <th>Actions</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-phone let-i="index">
                <tr>
                  <td>{{ phone.number }}</td>
                  <td>{{ phone.type }}</td>
                  <td><p-tableCheckbox [(ngModel)]="phone.primary" /></td>
                  <td>
                    <button pButton icon="pi pi-pencil" class="p-button-rounded p-button-text p-button-sm"></button>
                    <button pButton icon="pi pi-trash" class="p-button-rounded p-button-text p-button-sm" (click)="deletePhone(i)"></button>
                  </td>
                </tr>
              </ng-template>
            </p-table>
            <button pButton label="Add Phone Number" icon="pi pi-plus" (click)="showPhoneDialog()" class="mt-2 p-button-sm bg-blue-600 hover:bg-blue-700"></button>
          </p-card>
        </div>
    
        <!-- Addresses Card -->
        <div class="mt-4 bg-gray-800 p-4 rounded-lg shadow-md border border-gray-700">
          <p-card header="Addresses" class="bg-gray-900 text-white">
            <p-table [value]="customer.addresses" [paginator]="true" [rows]="3" class="mt-4 bg-gray-900 text-white">
              <ng-template pTemplate="header">
                <tr>
                  <th>Street</th>
                  <th>City</th>
                  <th>State</th>
                  <th>ZIP Code</th>
                  <th>Country</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Actions</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-address let-i="index">
                <tr>
                  <td>{{ address.street }}</td>
                  <td>{{ address.city }}</td>
                  <td>{{ address.state }}</td>
                  <td>{{ address.zipCode }}</td>
                  <td>{{ address.country }}</td>
                  <td>{{ address.type }}</td>
                  <td><p-tableCheckbox [(ngModel)]="address.isDefault" /></td>
                  <td>
                    <button pButton icon="pi pi-pencil" class="p-button-rounded p-button-text p-button-sm"></button>
                    <button pButton icon="pi pi-trash" class="p-button-rounded p-button-text p-button-sm" (click)="removeAddress(i)"></button>
                  </td>
                </tr>
              </ng-template>
            </p-table>
            <button class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 mt-2" (click)="addAddress()">Add Address</button>
          </p-card>
        </div>
    
      </div>
    </div>
    
      <div class="flex flex-wrap w-full md:w-full p-2"> <div class="md:p-2 p-1 w-full">
          <div class="bg-gray-800 p-4 rounded-lg shadow-md border border-gray-700">
            <div class="mx-auto max-w-screen-xl px-4 py-8 sm:px-6 sm:py-12 lg:px-8 bg-gray-900 rounded-lg">
              <div class="mx-auto max-w-3xl text-center">
                <h2 class="text-3xl font-bold text-yellow-500 sm:text-4xl">
                  Financial Status
                </h2>
              </div>

              <dl class="mt-6 grid grid-cols-2 gap-4 sm:mt-8 sm:grid-cols-2 lg:grid-cols-4">
                <div class="flex flex-col rounded-lg border border-gray-600 px-4 py-8 text-center bg-gray-900">
                  <dt class="order-last text-lg font-medium text-gray-400">Remaining Amount</dt>
                  <dd class="text-4xl font-extrabold text-blue-500 md:text-5xl">{{ customer.remainingAmount | currency }}</dd>
                </div>

                <div class="flex flex-col rounded-lg border border-gray-600 px-4 py-8 text-center bg-gray-900">
                  <dt class="order-last text-lg font-medium text-gray-400">
                    Purchased Amount
                  </dt>
                  <dd class="text-4xl font-extrabold text-blue-500 md:text-5xl">{{ customer.totalPurchasedAmount | currency }}</dd>
                </div>

                <div class="flex flex-col rounded-lg border border-gray-600 px-4 py-8 text-center bg-gray-900">
                  <dt class="order-last text-lg font-medium text-gray-400">Total BUY</dt>
                  <dd class="text-4xl font-extrabold text-blue-500 md:text-5xl">86</dd>
                </div>

                <div class="flex flex-col rounded-lg border border-gray-600 px-4 py-8 text-center bg-gray-900">
                  <dt class="order-last text-lg font-medium text-gray-400">Downloads</dt>
                  <dd class="text-4xl font-extrabold text-blue-500 md:text-5xl">86k</dd>
                </div>
              </dl>
            </div>
          </div>
        </div>
      </div>

      <div class="flex flex-wrap w-full p-2"> 
        <div class="md:p-2 p-1 w-full">
          <button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md font-semibold w-full">Save Customer</button>
        </div>
      </div>
    </div>
    
<p-dialog 
  header="Add Phone Number" 
  [(visible)]="phoneDialogVisible" 
  styleClass="p-dialog-compact bg-gray-800 text-white border border-gray-700 rounded-lg p-5 shadow-lg"
  [modal]="true"
  [closable]="true"
  [dismissableMask]="true"
  [breakpoints]="{'960px': '50vw', '640px': '90vw'}"
>
  <div class="p-fluid">
    <div class="p-field mb-3">
      <label for="phoneNumber" class="block text-sm font-medium text-gray-300 mb-1">Phone Number</label>
      <input id="phoneNumber" type="tel" pInputText [(ngModel)]="newPhoneNumber.number" required 
        class="p-inputtext w-full bg-gray-900 text-white border border-gray-600 rounded-md p-2 focus:ring-2 focus:ring-blue-500" 
        placeholder="Enter phone number" />
    </div>

    <div class="p-field mb-3">
      <label for="phoneType" class="block text-sm font-medium text-gray-300 mb-1">Phone Type</label>
      <p-select id="phoneType" [options]="phoneTypes" [(ngModel)]="newPhoneNumber.type" optionLabel="label" optionValue="value" required 
        class="p-select w-full bg-gray-900 text-white border border-gray-600 rounded-md p-2 focus:ring-2 focus:ring-blue-500">
      </p-select>
    </div>

    <div class="p-field flex items-center">
      <p-checkbox [(ngModel)]="newPhoneNumber.primary" inputId="primaryPhone" binary="true" class="mr-2"></p-checkbox>
      <label for="primaryPhone" class="text-sm text-gray-300">Set as Primary Number</label>
    </div>

    <div class="flex justify-end gap-2 mt-4">
      <p-button label="Cancel" icon="pi pi-times" (click)="phoneDialogVisible = false"
        class="p-button-text text-gray-400 hover:text-white"></p-button>
      <p-button label="Add Number" icon="pi pi-check" (click)="addPhoneNumber()"
        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md font-semibold"></p-button>
    </div>
  </div>
</p-dialog>

  <p-fileUpload hidden #fileUploader
    name="image"
    url="http://localhost:4000/api/customers/{{customerId}}/profile-image"
    accept="image/*"
    maxFileSize="5000000"
    (onSelect)="handleFileSelect($event)"
    (onUpload)="handleFileUpload($event)"
    [auto]="true"
    [showUploadButton]="false"
    [showCancelButton]="false">
  </p-fileUpload>

<p-dialog 
  header="Add Address" 
  [(visible)]="addressdialogvisible" 
  styleClass="p-dialog-compact bg-gray-800 text-white border border-gray-700 rounded-lg p-5 shadow-lg"
  [modal]="true"
  [closable]="true"
  [dismissableMask]="true"
  [breakpoints]="{'960px': '75vw', '640px': '90vw'}"
>
  <div class="p-fluid">
    <div class="p-field mb-3">
      <label for="street" class="block text-sm font-medium text-gray-300 mb-1">Street</label>
      <input id="street" type="text" pInputText [(ngModel)]="newAddress.street" required 
        class="p-inputtext w-full bg-gray-900 text-white border border-gray-600 rounded-md p-2" />
    </div>

    <div class="grid grid-cols-2 gap-4">
      <div class="p-field">
        <label for="city" class="block text-sm font-medium text-gray-300 mb-1">City</label>
        <input id="city" type="text" pInputText [(ngModel)]="newAddress.city" required 
          class="p-inputtext w-full bg-gray-900 text-white border border-gray-600 rounded-md p-2" />
      </div>
      
      <div class="p-field">
        <label for="state" class="block text-sm font-medium text-gray-300 mb-1">State</label>
        <input id="state" type="text" pInputText [(ngModel)]="newAddress.state" required 
          class="p-inputtext w-full bg-gray-900 text-white border border-gray-600 rounded-md p-2" />
      </div>
    </div>

    <div class="grid grid-cols-2 gap-4">
      <div class="p-field">
        <label for="zipCode" class="block text-sm font-medium text-gray-300 mb-1">ZIP Code</label>
        <input id="zipCode" type="text" pInputText [(ngModel)]="newAddress.zipCode" required 
          class="p-inputtext w-full bg-gray-900 text-white border border-gray-600 rounded-md p-2" />
      </div>

      <div class="p-field">
        <label for="country" class="block text-sm font-medium text-gray-300 mb-1">Country</label>
        <input id="country" type="text" pInputText [(ngModel)]="newAddress.country" required 
          class="p-inputtext w-full bg-gray-900 text-white border border-gray-600 rounded-md p-2" />
      </div>
    </div>

    <div class="p-field mb-3">
      <label for="addressType" class="block text-sm font-medium text-gray-300 mb-1">Address Type</label>
      <p-select id="addressType" [options]="addressTypes" [(ngModel)]="newAddress.type" optionLabel="label" optionValue="value" required 
        class="p-select w-full bg-gray-900 text-white border border-gray-600 rounded-md p-2"></p-select>
    </div>

    <div class="p-field flex items-center">
      <p-checkbox [(ngModel)]="newAddress.isDefault" inputId="defaultAddress" binary="true" class="mr-2"></p-checkbox>
      <label for="defaultAddress" class="text-sm text-gray-300">Set as Default Address</label>
    </div>

    <div class="flex justify-end gap-2 mt-4">
      <p-button label="Cancel" icon="pi pi-times" (click)="addressdialogvisible = false"
        class="p-button-text text-gray-400 hover:text-white"></p-button>
      <p-button label="Add Address" icon="pi pi-check" (click)="addAddress()"
        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md font-semibold"></p-button>
    </div>
  </div>
</p-dialog>
